<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高级密码生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        dark: '#1f2937',
                        light: '#f9fafb',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        success: '#10b981'
                    }
                }
            }
        }
    </script>
    <style>
        .password-item {
            transition: all 0.3s ease;
        }
        
        .notification {
            animation: slideIn 0.3s forwards, fadeOut 0.3s 1.7s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        
        .char-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
        }
        
        .char-checkbox:checked + .char-label {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .strength-meter {
            transition: width 0.5s ease, background-color 0.5s ease;
        }
        
        [type="checkbox"]:indeterminate {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3crect x='2' y='7' width='12' height='2' rx='1'/%3e%3c/svg%3e");
            border-color: transparent;
            background-color: currentColor;
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="min-h-screen py-8 px-4 sm:px-6">
        <div class="max-w-6xl mx-auto">
            <!-- 头部卡片 -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-200">
                <div class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold mb-4 flex items-center justify-center text-gray-800">
                        <i class="fas fa-lock mr-3 text-primary"></i>高级密码生成器
                    </h1>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                        生成高强度、安全的密码，支持批量生成和精细字符控制，保护您的账户安全
                    </p>
                </div>
            </div>
            
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- 控制面板 -->
                <div class="w-full lg:w-1/3 bg-white rounded-xl shadow p-6 border border-gray-200">
                    <h2 class="text-xl font-bold mb-6 flex items-center text-gray-800">
                        <i class="fas fa-sliders-h mr-3 text-primary"></i>设置选项
                    </h2>
                    
                    <!-- 密码长度 -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <label class="text-base font-medium text-gray-700">密码长度: <span id="length-value" class="text-primary font-bold">16</span></label>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600">6-50</span>
                        </div>
                        <input type="range" id="length" min="6" max="50" value="16" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                    </div>
                    
                    <!-- 生成数量 -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <label class="text-base font-medium text-gray-700">生成数量</label>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600">1-1,000,000</span>
                        </div>
                        <input type="number" id="quantity" min="1" max="1000000" value="20" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>
                    
                    <!-- 字符选项 -->
                    <div class="mb-6">
                        <h3 class="text-base font-medium mb-3 text-gray-700">包含字符类型:</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="uppercase" checked class="w-4 h-4 accent-primary rounded">
                                <label for="uppercase" class="ml-2 text-gray-700">大写字母 (A-Z)</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="lowercase" checked class="w-4 h-4 accent-primary rounded">
                                <label for="lowercase" class="ml-2 text-gray-700">小写字母 (a-z)</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="numbers" checked class="w-4 h-4 accent-primary rounded">
                                <label for="numbers" class="ml-2 text-gray-700">数字 (0-9)</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="symbols" checked class="w-4 h-4 accent-primary rounded">
                                <label for="symbols" class="ml-2 text-gray-700">特殊符号</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 快捷操作 -->
                    <div class="mb-6">
                        <h3 class="text-base font-medium mb-3 text-gray-700">快捷操作:</h3>
                        <div class="flex gap-2">
                            <button id="exclude-confusing-btn" class="px-4 py-2 bg-orange-100 text-orange-800 rounded-lg text-sm font-medium hover:bg-orange-200 transition">
                                <i class="fas fa-ban mr-1"></i> 屏蔽易混淆字符
                            </button>
                            <button id="select-all-btn" class="px-4 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium hover:bg-blue-200 transition">
                                <i class="fas fa-check-circle mr-1"></i> 全选所有字符
                            </button>
                        </div>
                    </div>
                    
                    <!-- 密码强度 -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-base font-medium text-gray-700">密码强度:</label>
                            <span id="strength-text" class="font-bold text-gray-800">强</span>
                        </div>
                        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div id="strength-meter" class="h-full bg-success w-full"></div>
                        </div>
                    </div>
                    
                    <!-- 生成按钮 -->
                    <button id="generate-btn" class="w-full py-3 bg-gradient-to-r from-primary to-blue-600 rounded-lg font-medium text-white text-base hover:opacity-90 transition-all shadow-md">
                        <i class="fas fa-key mr-2"></i>生成密码
                    </button>
                </div>
                
                <!-- 结果区域 -->
                <div class="w-full lg:w-2/3 bg-white rounded-xl shadow p-6 border border-gray-200 flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold flex items-center text-gray-800">
                            <i class="fas fa-list mr-3 text-primary"></i>生成的密码
                        </h2>
                        <div class="bg-gray-100 px-4 py-1.5 rounded-full text-gray-700">
                            数量: <span id="count" class="font-bold text-primary">0</span>
                        </div>
                    </div>
                    
                    <!-- 警告信息 -->
                    <div id="warning-message" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 hidden">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-exclamation-triangle text-yellow-400 text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    您生成了大量密码，为提升性能，结果仅提供下载。生成完成后请使用"下载所有密码"按钮。
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 密码列表 -->
                    <div id="password-container" class="flex-1 overflow-y-auto mb-6 grid grid-cols-1 md:grid-cols-2 gap-3 max-h-[500px]">
                        <div class="text-center py-12 text-gray-400" id="empty-state">
                            <i class="fas fa-key text-4xl mb-4 opacity-30"></i>
                            <p class="text-lg">生成的密码将显示在这里</p>
                        </div>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button id="download-btn" class="flex-1 py-3 bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg font-medium text-white hover:opacity-90 transition-opacity shadow disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-download mr-2"></i>下载所有密码
                        </button>
                        <button id="copy-all-btn" class="flex-1 py-3 bg-gradient-to-r from-primary to-blue-600 rounded-lg font-medium text-white hover:opacity-90 transition-opacity shadow disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <i class="fas fa-copy mr-2"></i>复制全部
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 自定义字符控制 -->
            <div class="mt-6 bg-white rounded-xl shadow p-6 border border-gray-200">
                <h2 class="text-xl font-bold mb-4 flex items-center text-gray-800">
                    <i class="fas fa-cog mr-3 text-primary"></i>自定义字符控制
                </h2>
                <p class="text-gray-600 mb-4">取消勾选您不希望出现在密码中的字符（取消字符后，对应类别将显示为部分选中状态）</p>
                
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3 text-gray-800 border-b pb-2">大写字母 (A-Z)</h3>
                    <div class="char-grid mb-4" id="uppercase-chars">
                        <!-- 大写字母将由JS生成 -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3 text-gray-800 border-b pb-2">小写字母 (a-z)</h3>
                    <div class="char-grid mb-4" id="lowercase-chars">
                        <!-- 小写字母将由JS生成 -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-3 text-gray-800 border-b pb-2">数字 (0-9)</h3>
                    <div class="char-grid mb-4" id="number-chars">
                        <!-- 数字将由JS生成 -->
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-medium mb-3 text-gray-800 border-b pb-2">特殊符号</h3>
                    <div class="char-grid" id="symbol-chars">
                        <!-- 符号将由JS生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 通知 -->
        <div id="notification" class="fixed top-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg font-medium hidden notification">
            <i class="fas fa-check-circle mr-2"></i> 密码已复制到剪贴板！
        </div>
    </div>
    <script src="/js/background.js"></script>
    <script>
        // DOM元素
        const lengthSlider = document.getElementById('length');
        const lengthValue = document.getElementById('length-value');
        const quantityInput = document.getElementById('quantity');
        const uppercaseCheckbox = document.getElementById('uppercase');
        const lowercaseCheckbox = document.getElementById('lowercase');
        const numbersCheckbox = document.getElementById('numbers');
        const symbolsCheckbox = document.getElementById('symbols');
        const generateBtn = document.getElementById('generate-btn');
        const passwordContainer = document.getElementById('password-container');
        const downloadBtn = document.getElementById('download-btn');
        const copyAllBtn = document.getElementById('copy-all-btn');
        const countElement = document.getElementById('count');
        const notification = document.getElementById('notification');
        const strengthMeter = document.getElementById('strength-meter');
        const strengthText = document.getElementById('strength-text');
        const warningMessage = document.getElementById('warning-message');
        const emptyState = document.getElementById('empty-state');
        const excludeConfusingBtn = document.getElementById('exclude-confusing-btn');
        const selectAllBtn = document.getElementById('select-all-btn');
        
        // 字符容器
        const uppercaseCharsContainer = document.getElementById('uppercase-chars');
        const lowercaseCharsContainer = document.getElementById('lowercase-chars');
        const numberCharsContainer = document.getElementById('number-chars');
        const symbolCharsContainer = document.getElementById('symbol-chars');
        
        // 字符集定义
        const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const lowercase = 'abcdefghijklmnopqrstuvwxyz';
        const numbers = '0123456789';
        const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?~';
        
        // 易混淆字符
        const confusingChars = 'Il1|O0';
        
        // 字符状态
        let charState = {
            uppercase: {},
            lowercase: {},
            numbers: {},
            symbols: {}
        };
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initCharState();
            renderCharControls();
            updateSliders();
            updateStrengthMeter();
            
            // 初始生成密码
            setTimeout(generatePasswords, 300);
        });
        
        // 初始化字符状态
        function initCharState() {
            // 初始化大写字母
            for (let char of uppercase) {
                charState.uppercase[char] = true;
            }
            
            // 初始化小写字母
            for (let char of lowercase) {
                charState.lowercase[char] = true;
            }
            
            // 初始化数字
            for (let char of numbers) {
                charState.numbers[char] = true;
            }
            
            // 初始化符号
            for (let char of symbols) {
                charState.symbols[char] = true;
            }
        }
        
        // 渲染字符控制
        function renderCharControls() {
            renderCharSet(uppercase, uppercaseCharsContainer, 'uppercase');
            renderCharSet(lowercase, lowercaseCharsContainer, 'lowercase');
            renderCharSet(numbers, numberCharsContainer, 'numbers');
            renderCharSet(symbols, symbolCharsContainer, 'symbols');
            
            // 更新类别复选框状态
            updateCategoryCheckbox('uppercase');
            updateCategoryCheckbox('lowercase');
            updateCategoryCheckbox('numbers');
            updateCategoryCheckbox('symbols');
        }
        
        // 渲染字符集
        function renderCharSet(chars, container, type) {
            container.innerHTML = '';
            
            for (let char of chars) {
                const charId = `char-${type}-${char}`;
                
                const charElement = document.createElement('div');
                charElement.className = 'flex flex-col items-center';
                charElement.innerHTML = `
                    <input type="checkbox" id="${charId}" 
                        class="char-checkbox hidden" 
                        ${charState[type][char] ? 'checked' : ''}
                        data-type="${type}" 
                        data-char="${char}">
                    <label for="${charId}" class="char-label w-8 h-8 flex items-center justify-center border border-gray-300 rounded-md cursor-pointer hover:border-primary transition">
                        ${char}
                    </label>
                `;
                
                container.appendChild(charElement);
                
                // 添加事件监听器
                const checkbox = charElement.querySelector('input');
                checkbox.addEventListener('change', function() {
                    charState[type][char] = this.checked;
                    updateCategoryCheckbox(type);
                    updateStrengthMeter();
                });
            }
        }
        
        // 更新类别复选框状态
        function updateCategoryCheckbox(type) {
            const chars = Object.values(charState[type]);
            const allChecked = chars.every(val => val);
            const someChecked = chars.some(val => val);
            
            const checkbox = document.getElementById(type);
            checkbox.checked = allChecked;
            checkbox.indeterminate = !allChecked && someChecked;
        }
        
        // 更新滑块显示值
        function updateSliders() {
            lengthValue.textContent = lengthSlider.value;
        }
        
        // 更新密码强度指示器
        function updateStrengthMeter() {
            const length = parseInt(lengthSlider.value);
            let charTypes = 0;
            
            // 计算实际使用的字符类型数量
            if (Object.values(charState.uppercase).some(v => v)) charTypes++;
            if (Object.values(charState.lowercase).some(v => v)) charTypes++;
            if (Object.values(charState.numbers).some(v => v)) charTypes++;
            if (Object.values(charState.symbols).some(v => v)) charTypes++;
            
            // 计算密码强度（0-100）
            let strength = Math.min(100, (length * 2) + (charTypes * 20));
            
            // 确保至少选择一种字符类型
            if (charTypes === 0) {
                strength = 0;
            }
            
            strengthMeter.style.width = strength + '%';
            
            // 更新强度文本和颜色
            if (strength === 0) {
                strengthText.textContent = '无';
                strengthMeter.className = 'h-full bg-gray-400 w-full';
            } else if (strength < 40) {
                strengthText.textContent = '弱';
                strengthMeter.className = 'h-full bg-danger w-full';
            } else if (strength < 70) {
                strengthText.textContent = '中等';
                strengthMeter.className = 'h-full bg-warning w-full';
            } else {
                strengthText.textContent = '强';
                strengthMeter.className = 'h-full bg-success w-full';
            }
        }
        
        // 获取当前字符集
        function getCurrentCharset() {
            let charset = '';
            
            // 添加大写字母
            for (let char in charState.uppercase) {
                if (charState.uppercase[char]) charset += char;
            }
            
            // 添加小写字母
            for (let char in charState.lowercase) {
                if (charState.lowercase[char]) charset += char;
            }
            
            // 添加数字
            for (let char in charState.numbers) {
                if (charState.numbers[char]) charset += char;
            }
            
            // 添加符号
            for (let char in charState.symbols) {
                if (charState.symbols[char]) charset += char;
            }
            
            return charset;
        }
        
        // 生成单个密码
        function generatePassword() {
            const length = parseInt(lengthSlider.value);
            const charset = getCurrentCharset();
            
            // 如果没有选择任何字符，使用默认字符集
            if (charset === '') {
                return '请至少选择一种字符';
            }
            
            let password = '';
            const values = new Uint32Array(length);
            window.crypto.getRandomValues(values);
            
            for (let i = 0; i < length; i++) {
                password += charset[values[i] % charset.length];
            }
            
            return password;
        }
        
        // 批量生成密码
        function generatePasswords() {
            const quantity = parseInt(quantityInput.value);
            
            // 清除现有密码
            passwordContainer.innerHTML = '';
            
            // 更新计数
            countElement.textContent = quantity.toLocaleString();
            
            // 启用下载按钮
            downloadBtn.disabled = false;
            copyAllBtn.disabled = false;
            
            // 如果数量超过100，显示警告
            if (quantity > 100) {
                warningMessage.classList.remove('hidden');
                emptyState.classList.add('hidden');
                
                // 生成密码但不显示
                window.generatedPasswords = [];
                for (let i = 0; i < quantity; i++) {
                    window.generatedPasswords.push(generatePassword());
                }
            } else {
                warningMessage.classList.add('hidden');
                
                // 生成并显示密码
                for (let i = 0; i < quantity; i++) {
                    const password = generatePassword();
                    
                    const passwordElement = document.createElement('div');
                    passwordElement.className = 'password-item bg-gray-50 border border-gray-200 rounded-lg p-4 flex items-center justify-between';
                    passwordElement.innerHTML = `
                        <div class="font-mono text-gray-800 tracking-wider break-all pr-4">${password}</div>
                        <button class="copy-btn bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1.5 rounded-lg transition-colors" data-password="${password}">
                            <i class="fas fa-copy"></i>
                        </button>
                    `;
                    
                    passwordContainer.appendChild(passwordElement);
                }
                
                // 添加复制事件监听器
                document.querySelectorAll('.copy-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const password = this.getAttribute('data-password');
                        copyToClipboard(password);
                    });
                });
                
                // 隐藏空状态
                if (quantity > 0) {
                    emptyState.classList.add('hidden');
                }
            }
        }
        
        // 屏蔽易混淆字符
        function excludeConfusingCharacters() {
            // 处理大写字母
            for (let char of uppercase) {
                if (confusingChars.includes(char)) {
                    charState.uppercase[char] = false;
                }
            }
            
            // 处理小写字母
            for (let char of lowercase) {
                if (confusingChars.includes(char)) {
                    charState.lowercase[char] = false;
                }
            }
            
            // 处理数字
            for (let char of numbers) {
                if (confusingChars.includes(char)) {
                    charState.numbers[char] = false;
                }
            }
            
            // 处理符号
            for (let char of symbols) {
                if (confusingChars.includes(char)) {
                    charState.symbols[char] = false;
                }
            }
            
            // 重新渲染字符控制
            renderCharControls();
            updateStrengthMeter();
        }
        
        // 全选所有字符
        function selectAllCharacters() {
            // 处理大写字母
            for (let char of uppercase) {
                charState.uppercase[char] = true;
            }
            
            // 处理小写字母
            for (let char of lowercase) {
                charState.lowercase[char] = true;
            }
            
            // 处理数字
            for (let char of numbers) {
                charState.numbers[char] = true;
            }
            
            // 处理符号
            for (let char of symbols) {
                charState.symbols[char] = true;
            }
            
            // 重新渲染字符控制
            renderCharControls();
            updateStrengthMeter();
        }
        
        // 复制到剪贴板
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification();
            }).catch(err => {
                console.error('复制失败: ', err);
            });
        }
        
        // 显示通知
        function showNotification() {
            notification.classList.remove('hidden');
            
            // 3秒后隐藏通知
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 2000);
        }
        
        // 下载密码
        function downloadPasswords() {
            const quantity = parseInt(quantityInput.value);
            let content = '';
            
            if (quantity > 100 && window.generatedPasswords) {
                // 使用之前生成的大量密码
                window.generatedPasswords.forEach(pwd => {
                    content += pwd + '\n';
                });
            } else {
                // 从页面获取密码
                const passwordElements = document.querySelectorAll('.font-mono');
                if (passwordElements.length === 0) return;
                
                passwordElements.forEach(el => {
                    content += el.textContent + '\n';
                });
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `passwords-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 100);
        }
        
        // 复制所有密码
        function copyAllPasswords() {
            const quantity = parseInt(quantityInput.value);
            let content = '';
            
            if (quantity > 100 && window.generatedPasswords) {
                // 使用之前生成的大量密码
                content = window.generatedPasswords.join('\n');
            } else {
                // 从页面获取密码
                const passwordElements = document.querySelectorAll('.font-mono');
                if (passwordElements.length === 0) return;
                
                passwordElements.forEach(el => {
                    content += el.textContent + '\n';
                });
            }
            
            copyToClipboard(content);
        }
        
        // 事件监听器
        lengthSlider.addEventListener('input', function() {
            updateSliders();
            updateStrengthMeter();
        });
        
        quantityInput.addEventListener('input', function() {
            const value = parseInt(this.value);
            if (value > 1000000) this.value = 1000000;
            if (value < 1) this.value = 1;
        });
        
        // 添加类别复选框事件
        uppercaseCheckbox.addEventListener('change', function() {
            for (let char in charState.uppercase) {
                charState.uppercase[char] = this.checked;
            }
            renderCharControls();
            updateStrengthMeter();
        });
        
        lowercaseCheckbox.addEventListener('change', function() {
            for (let char in charState.lowercase) {
                charState.lowercase[char] = this.checked;
            }
            renderCharControls();
            updateStrengthMeter();
        });
        
        numbersCheckbox.addEventListener('change', function() {
            for (let char in charState.numbers) {
                charState.numbers[char] = this.checked;
            }
            renderCharControls();
            updateStrengthMeter();
        });
        
        symbolsCheckbox.addEventListener('change', function() {
            for (let char in charState.symbols) {
                charState.symbols[char] = this.checked;
            }
            renderCharControls();
            updateStrengthMeter();
        });
        
        generateBtn.addEventListener('click', generatePasswords);
        downloadBtn.addEventListener('click', downloadPasswords);
        copyAllBtn.addEventListener('click', copyAllPasswords);
        excludeConfusingBtn.addEventListener('click', excludeConfusingCharacters);
        selectAllBtn.addEventListener('click', selectAllCharacters);
    </script>
</body>
</html>
